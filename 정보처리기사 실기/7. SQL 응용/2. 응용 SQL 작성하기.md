# 2-1 집계성 SQL 작성

## 1. 데이터 분석 함수의 개념
- 복수 행 기준의 데이터를 모아서 처리하는 것을 목적으로 하는 다중 행 함수
- 다중 행 연산자 :
    - 서브 쿼리의 결과가 여러 개의 튜플을 반환하는 다중 행 서브쿼리에서 사용되는 연산자
    - 종류 : 
        - IN : 리턴되는 값 중에서 조건에 해당하는 값이 있으면 참
        - ANY : 서브쿼리에 의해 리턴되는 각각의 값과 조건을 비교하여 하나 이상을 만족하면 참
        - ALL : 값을 서브쿼리에 의해 리턴되는 모든 값과 조건 값을 비교하여 모든 값을 만족해야만 참
        - EXISTS : 메인 쿼리의 비교 조건이 서브쿼리의 결과 중에서 만족하는 값이 하나라도 존재하면 참

## 2. 집계 함수
- 여러 행 또는 테이블 전체 행으로부터 하나의 결과값을 반환
- GROUP BY : 복수 ROW 대상의 데이터 분석 시 그룹핑 대상이 되는 부분 선별을 위해 사용
- HAVING : WHERE 구문 내에는 사용할 수 없는 집계 함수의 구문을 적용하여 복수 행의 계산 결과를 조건별로 적용하는데 사용
- 종류 :
    - COUNT : 복수 행의 줄 수 -> COUNT(*) = NULL 포함, COUNT(컬럼명) = NULL 미포함
    - SUM : 복수 행의 해당 컬럼 간의 함계
    - AVG : 복수 행의 해당 컬럼 간의 평균
    - MAX : 복수 행의 해당 컬럼 중 최댓값
    - MIN : 복수 행의 해당 컬럼 중 최솟값
    - STDDEV : 복수 행의 해당 컬럼 간의 표준편차
    - VARIANCE : 복수 행의 해당 컬럼 간의 분산

## 3. 그룹 함수
- 테이블의 전체 행을 하나 이상의 컬럼을 기준으로 컬럼 값에 따라 그룹화하여 그룹별로 결과 출력
- ROLLUP :
    - 중간 집계 값을 산출하기 위한 그룹 함수
    - 지정 컬럼 수보다 하나 더 큰 레벨만큼의 중간 집계 값 생성
    - 계층별로 구성되기 때문에 순서가 바뀌면 수행 결과가 바뀜
    ```
    SELECT 컬럼1, 컬럼2, ..., 집계 함수
    FROM 테이블명
    [WHERE ...]
    GROUP BY [컬럼 ...] ROLLUP (컬럼1, ...)
    [HAVING ...]
    [ORDER BY ...]
    ```

- CUBE :
    - 결합 가능한 모든 값에 대해 다차원 집계를 생성
    ```
    SELECT 컬럼명1, ..., 집계 함수
    FROM 테이블명
    [WHERE ...]
    GROUP BY [컬럼명1, ...] CUBE (컬럼명a, ...)
    [HAVING ...]
    [ORDER BY ...]
    ```
- GROUPING SETS :
    - 집계 대상 컬럼들에 대한 개별 집계를 구함
    - 컬럼 간 순서와 무관한 결과를 얻을 수 있음
    ```
    SELECT 컬럼명1, ..., 집계 함수
    FROM 테이블명
    [WHERE ...]
    GROUP BY [컬럼명1, ...] GROUPING SETS (컬럼명1, ...)
    [HAVING ...]
    [ORDER BY ...]
    ```

## 4. 윈도 함수 (OLAP)
- 데이터베이스를 사용한 온라인 분석 처리 용도
```
SELECT 함수명 (파라미터)
OVER
([PARITITION BY 컬럼1, ...]
[ORDER BY 컬럼A, ...])
FROM 테이블명
```
- 순위 함수 :
    - RANK : 특정 항목에 대한 순위 구함
    - DENSE_RANK : 레코드의 순위 계산
    - ROW_NUMBER : 레코드의 순위 계산
