#  1-1 트랜잭션

## 1. 트랜잭션
- 인가받지 않은 사용자로부터 데이터를 보장하기 위해 DBMS가 가져야 하는 특성, 데이터베이스 시스템에서 하나의 논리적 기능을 정상적으로 수행하기 위한 작업의 기본 단위

- 특성 :
    - 원자성 : 트랜잭션을 구성하는 연산 전체가 모두 정상적으로 실행되거나 모두 취소되어야 함
    - 일관성 : 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야함
    - 격리성 (고립성) : 동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않아야 함
    - 영속성 : 성공이 완료된 트랜잭션의 결과는 영속적으로 데이터베이스에 저장되어야 함

- 트랜잭션 제어 (TCL) :
    - 커밋 : 트랜잭션을 메모리에 영구적으로 저장
    - 롤백 : 트랜잭션 내영을 저장 무효화
    - 체크포인트 : ROLLBACK을 위한 시점을 지정

- 병행 제어 :
    - 다수 사용자 환경에서 여러 트랜잭션을 수행할 때, 데이터베이스 일관성 유지를 위해 상호 작용을 제어하는 기법
    - 데이터베이스 공유 최대화, 시스템 활용도 최대화
    - 병행 제어 미보장 시 문제점 :
      - 갱신 손실 : 먼저 실행된 트랜잭션의 결과를 나중에  실행된 트랜잭션이 덮어쓸 때 발생하는 오류
      - 현황 파악오류 : 트랜잭션의 중간 수행 결과를 다른 트랜잭션이 참조하여 발생하는 오류
      - 모순성 : 두 트랜잭션이 동시에 실행되어 데이터베이스의 일관성이 결여되는 오류
      - 연쇄복귀 : 복수의 트랜잭션이 데이터 공유 시 특정 트랜잭션이 처리를 추소할 경우 트랜잭션이 처리한 곳의 부분을 취소하지 못하는 오류

    - 병행 제어 기법 종류 :
        - 로킹 : 하나의 트랜잭션을 시작하는 동안 특정 데이터 항목에 대해 다른 트랜잭션이 동시에 접근하지 못하도록 상호배제 기능 제공
        - 낙관적 검증 : 트랜잭션이 어떠한 검증도 수행하지 않고 일단 트랜잭션을 수행하고, 트랜잭션 종료 시 검증을 수행하여 데이터베이스에 반영
        - 타임 스탬프 순서 : 트랜잭션과 트랜잭션이 읽거나 갱신한 데이터에 대해 트랜잭션이 실행을 시작하기 전에 타임 스탬프를 부여하여 부여된 시간에 따라 트랜잭션 작업을 수행
        - 다중버전 동시성 제어 (MVCC) : 트랜잭션의 타임스탬프와 접근하려는 데이터 타임스탬프를 비교하여 직렬가능성이 보장되는 적절한 버전을 선택하여 접근
- 데이터베이스 고립화 수준 :
  - 다른 트랜잭션이 현재의 데이터에 대한 무결성을 해치지 않기 위해 잠금을 설정하는 정도
  - 종류 :
    - Read Uncommitted : 한 트랜잭션에서 연산중인 데이터를 다른 트랜잭션이 읽는 것을 허용하는 수준
    - Read Committed : 한 트랜잭션에서 연산을 수행할 때, 연산이 완료될 때까지 연산 대상 데이터에 대한 읽기를 제한하는 수준
    - Repeatable Read : 선행 트랜잭션이 특정 데이터를 읽을 때, 트랜잭션 종료 시까지 해당 데이터에 대한 갱신, 삭제를 제한하는 수준
    - Serializable Read : 선행 트랜잭션이 특정 데이터 영역을 순차적으로 읽을 때, 해당 데이터 영역 전체에 대한 접근 제한하는 수준

- 회복 기법 :
  - 트랜잭션을 수행하는 도중 장애로 인해 손상된 데이터베이스를 손상되기 이전의 정상적인 상태로 복구시키는 작업
  - 회복 기법 종류 :
    - REDO : 데이터베이스가 비정상적으로 종료되었을 때 디스크에 저장된 로그를 분석하여 트랜잭션의 시작과 완료에 대한 기록이 있는 트랜잭션들의 작업을 재작업하는 기법
    - UNDO : 데이터베이스가 비정상적으로 종료되었을 때 디스크에 저장된 로그를 분석하여 트랜잭션의 시작은 있지만, 완료 기록이 없는 트랜잭션들이 작업한 변경 내용들을 모두 취소하는 기법
    - 로그 기반 회복 기법 :
      - 지연 갱신 회복 기법 : 트랜잭션이 완료되기 전까지 데이터베이스에 기록하지 않는 기법
      - 즉각 갱신 회복 기법 : 트랜잭션 수행 중 갱신 결과를 바로 DB에 반영하는 기법
    - 체크 포인트 회복 기법 : 장애 발생 시 검사점 이후에 처리된 트랜잭션에 대해서만 장애 발생 이전의 상태로 복원시키는 회복 기법
    - 그림자 페이징 회복 기법 : 데이터베이스 트랜잭션 수행 시 복제본을 생성하여 데이터베이스 장애 시 이를 이용해 복구하는 기법

## 2. 데이터 정의어 (DDL)
- 데이터를 구조를 정의하는 언어
- 대상 :
    - 도메인 : 하나의 속성이 가질 수 있는 원자들의 집합
    - 스키마 :
        - 데이터베이스의 구조, 제약조건 등의 정보를 담고 있는 기본적인 구조
        - 외부 스키마 : 사용자나 개발자의 관점에서 필요로 하는 데이터베이스의 논리적 구조
        - 개념 스키마 : 데이터베이스의 전체적인 논리적 구조
        - 내부 스키마 : 물리적 저장 장치의 관점에서 보는 데이터베이스 구조
        - 테이블 : 데이터 저장 공간
        - 뷰 : 
          - 하나 이상의 물리 테이블에서 유도되는 가상의 테이블
          - 특징 :
            - 논리적 데이터 독립성 제공 : 데이터베이스에 영향을 주지 않고 애플리케이션이 원하는 형태로 데이터에 접근 가능
            - 데이터 조작 연산 간소화 : 애플리케이션이 원하는 형태의 논리적 구조를 형성하여 데이터 조작 연산을 간소화
            - 보안 기능 제공 : 특정 필드만을 선택해 뷰를 생성할 경우 애플리케이션은 선택되지 않은 필드의 조회 및 접근 불가
            - 뷰 변경 불가 : 뷰 정의는 ALTER 문을 이용하여 변경할 수 없음
        - 인덱스 : 
          - 검색을 빠르게 하기 위한 데이터 구조
          - 종류 :
            - 순서 인덱스 : 데이터가 정렬된 순서로 생성되는 인덱스
            - 해시 인덱스 : 해시 함수에 의해 직접 데이터에 키 값으로 접근하는 인덱스
            - 비트맵 인덱스 : 각 컬럼에 적은 개수 값이 저장된 경우 선택하는 인덱스
            - 함수기반 인덱스 : 수식이나 함수를 적용하여 만든 인덱스
            - 단일 인덱스 : 하나의 컬럼으로만 구성한 인덱스
            - 결합 인덱스 : 두 개 이상의 컬럼으로 구성한 인덱스
            - 클러스터드 인덱스 : 기본 키 기준으로 레코드를 묶어서 저장하는 인덱스

- DDL 명령어 :
    - CREATE : 데이터베이스 오브젝트 생성
    - ALTER : 데이터베이스 오브젝트 변경
    - DROP : 데이터베이스 오브젝트 삭제
    - TRUNCATE : 데이터베이스 오브젝트 내용 삭제

- TABLE 관련 DDL :
    - CREATE TABLE :
        ```
        CREATE TABLE 테이블명(
            컬럼명 데이터타입 [제약조건],
        );
        ```
        - 제약조건 :
            - PRIMARY KEY : 테이블의 기본 키를 정의
            - FOREIGN KEY : 외래 키를 정의
            - UNIQUE : 테이블 내에서 얻은 유일한 값을 갖도록 하는 제약조건
            - NOT NULL : NULL 값을 포함하지 않도록 하는 제약조건
            - CHECK : 개발자가 정의하는 제약조건
            - DEFAULT : 데이터를 INSERT 할 때 해당 컬럼의 값을 넣지 않는 경우 기본값으로 설정해 주는 제약조건

    - ALTER TABLE :
        - 컬럼 추가 문법
        ```
        ALTER TABLE 테이블명 ADD 컬럼명 데이터타입 [제약조건];
        ```

        - 컬럼 수정 문법
        ```
        ALTER TABLE 테이블명 MODIFY 컬럼명 데이터타입 [제약조건];
        ```

        - 컬럼 삭제 문법
        ```
        ALTER TABLE 테이블명 DROP COLUMN 컬럼명; 
        ```

    - DROP TABLE :
        - 테이블 삭제 문법
        ```
        DROP TABLE 테이블명 [CASCADE OR RESTRICT] 
        ```
        - CASCADE : 참조하는 테이블까지 연쇄적으로 제거
        - RESTRICT : 다른 테이블이 삭제할 테이블을 참조 중이면 제거 X

    - TRUNCATE TABLE :
        - 테이블 내의 데이터들 삭제
        ```
        TRUNCATE TABLE 테이블명;
        ```

- VIEW 관련 DDL :
    - 뷰는 수정 불가 
    - CREATE VIEW :
        - 뷰 생성
        ```
        CREATE VIEW 뷰이름 AS
        조회커리
        ```
        - 뷰 테이블의 SELECT 문에는 UNION, ORDER BY 사용불가

    - CREATE OR REPLACE VIEW :
        - 뷰 교체
        ```
        CREATE OR REPLACE 뷰이름 AS
        조회커리
        ```
    - DROP VIEW :
        -  뷰 삭제
        ```
        DROP VIEW 뷰이름;
        ```

- INDEX 관련 DDL :
    - CREATE INDEX :
        - 인덱스 생성
        - UNIQUE 생략 가능, 인덱스 걸린 컬럼에 중복 값 허용 X
        ```
        CREATE [UNIQUE] INDEX 인덱스명 ON 테이블명(컬럼명1, ...);
        ```

    - ALTER INDEX :
        - 인덱스 수정
        ```
        ALTER [UNIQUE] INDEX 인덱스명 ON 테이블명(컬럼명 1, ...);
        ``` 

    - DROP INDEX :
        - 인덱스 삭제
        ```
        DROP INDEX 인덱스명;
        ``` 

## 3. 데이터 조작어 (DML)
- 데이터베이스에 저장된 자료들을 입력, 수정, 삭제, 조회
- SELECT :
    - 테이블 내 칼럼에 저장된 데이터를 조회
    ```
    SELECT [ALL (모든 튜플 검색) OR DISTINCT (중복 제거)] 속성명1, ... 
    FROM 테이블명1, ... //검색될 데이터가 있는 테이블명
    [WHERE 조건] // 검색할 조건
    [GROUP BY 속성명1, ...] //속성값을 그룹으로 분류
    [HAVING 그룹조건] / 그룹에 대한 조건 지정
    [ORDER BY 속성 [ASC (오름차순) OR DESC (내림차순)] ]; 
    ```

    - WHERE 절 : 
        - 컬럼 LIKE 패턴 -> 컬럼이 패턴에 포함된 경우 데이터 조화
        - % : 0개 이상의 문자열과 일치
        - [] : 1개의 문자와 일치
        - [^] : 1개의 문자와 불일치
        - _ : 특정 위치의 1개의 문자와 일치

    - 조인 :
        - 2개 이상의 테이블을 연결하여 데이터를 검색
        - 논리적 조인 유형 :
            - 내부 조인 : 공통 존재 칼럼의 값이 같은 경우 추출하는 기법
            - 외부 조인 : 왼쪽 외부 조인, 오른쪽 외부 조인, 완전 외부 조인
            - 교차 조인 : 조인 조건이 없는 모든 데이터 조합 추출
            - 셀프 조인 : 자기 자신에게 별칭을 지정한 후 다시 조인

    - 서브쿼리 :
        - SQL 문 안에 포함된 또 다른 SQL 문
        - 알려지지 않은 기준을 위한 검색을 위해 사용
        - FROM 절 서브쿼리 : 서브쿼리가 FROM 절 안에 들어있는 형태 -> 인라인 뷰
        - WHERE 절 서브쿼리 : 서브쿼리가 WHERE 절 안에 들어있는 형태 -> 중첩 서브쿼리

    - 집합 연산자 :
        - 테이블을 집합 개념으로 보고, 두 테이블 연산에 집합 연산자 사용
        - 유형 :
            - UNION : 중복 행이 제거된 쿼리 결과 반환
            - UNION ALL : 중복 행이 제거되지 않은 쿼리 결과 반환
            - INTERSECT : 중복 결과 반환
            - MINUS : 첫 쿼리에 있고 두 번쨰 쿼리에는 없는 결과 반환

- INSERT 명령어 :
    ```
    INSERT INTO 테이블명 (속성명1, ...)
    VALUES (데이터1, ...);
    ```

- UPDATE 명령어 :
    - 데이터의 내용 변경
    ``` 
    UPDATE 테이블명
    SET 속성명 = 데이터, ...
    WHERE 조건;
    ```

- DELETE 명령어 :
    ```
    DELETE FROM 테이블명
    WHERE 조건;
    ```

## 4. 데이터 제어어 (DCL)
- 데이터 보안, 무결성 유지, 병행 제어, 회복을 위해 관리자가 사용하는 제어용 언어
- GRANT : 사용자에게 데이터베이스에 대한 권한을 부여
```
GRAMT 권한 ON 테이블 TO 사용자;
```
- REVOKE : 사용자에게 부여했던 권한 회수
```
REVOKE 권한 ON 테이블 FROM 사용자;
```